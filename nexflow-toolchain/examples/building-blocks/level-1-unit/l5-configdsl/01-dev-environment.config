// =============================================================================
// L5-01: Development Environment Configuration
// =============================================================================
// Use Case: Configure job for local development and testing
// Pattern:  Minimal infrastructure, local services, debug settings
// When:     Local development, unit testing, quick iteration
// =============================================================================

environment dev
    description "Local development environment configuration"

    // Kafka configuration - local broker
    kafka:
        bootstrap_servers: "localhost:9092"
        consumer:
            group_id: "dev-consumer-group"
            auto_offset_reset: "earliest"
            enable_auto_commit: true
        producer:
            acks: "1"
            retries: 0
    end

    // Flink configuration - local execution
    flink:
        parallelism: 1
        checkpoint:
            enabled: false
        state_backend: "memory"
    end

    // Database connections
    database:
        primary:
            url: "jdbc:postgresql://localhost:5432/nexflow_dev"
            username: "dev_user"
            password: "${DB_PASSWORD:dev_password}"
            pool_size: 5
        end
    end

    // Redis for caching (local)
    redis:
        host: "localhost"
        port: 6379
        database: 0
    end

    // Logging configuration
    logging:
        level: "DEBUG"
        format: "text"
        include_stacktrace: true
    end

    // Metrics - disabled for dev
    metrics:
        enabled: false
    end

    // Feature flags
    features:
        enable_detailed_logging: true
        enable_debug_endpoints: true
        skip_external_validation: true
    end
end

// -----------------------------------------------------------------------------
// Variation: Docker Compose local environment
// -----------------------------------------------------------------------------

environment docker_local
    description "Docker Compose local environment"

    kafka:
        bootstrap_servers: "kafka:29092"
        consumer:
            group_id: "docker-consumer"
            auto_offset_reset: "earliest"
        end
    end

    flink:
        parallelism: 2
        checkpoint:
            enabled: true
            interval: 60000
            directory: "file:///tmp/flink-checkpoints"
        end
        state_backend: "rocksdb"
    end

    database:
        primary:
            url: "jdbc:postgresql://postgres:5432/nexflow"
            username: "nexflow"
            password: "${POSTGRES_PASSWORD}"
            pool_size: 10
        end
    end

    redis:
        host: "redis"
        port: 6379
    end

    logging:
        level: "INFO"
        format: "json"
    end
end

// -----------------------------------------------------------------------------
// Variation: Test environment
// -----------------------------------------------------------------------------

environment test
    description "Automated testing environment"

    kafka:
        // Use embedded Kafka for tests
        bootstrap_servers: "${KAFKA_BOOTSTRAP:localhost:9092}"
        consumer:
            group_id: "test-consumer-${random.uuid}"
            auto_offset_reset: "earliest"
        end
    end

    flink:
        parallelism: 1
        checkpoint:
            enabled: false
        end
        state_backend: "memory"
    end

    database:
        primary:
            // Use H2 in-memory for tests
            url: "jdbc:h2:mem:testdb;MODE=PostgreSQL"
            username: "sa"
            password: ""
            pool_size: 2
        end
    end

    logging:
        level: "WARN"
        format: "text"
    end

    // Test-specific settings
    test:
        timeout_seconds: 30
        cleanup_after_test: true
        mock_external_services: true
    end
end

// =============================================================================
// What This Generates:
// - Configuration properties files
// - Environment-specific application.yaml
// - Flink configuration setup
//
// Key Sections:
// - kafka: Kafka broker and consumer/producer settings
// - flink: Parallelism, checkpointing, state backend
// - database: JDBC connections with pooling
// - redis: Cache configuration
// - logging: Log levels and formats
// - metrics: Metrics collection settings
// - features: Feature flags for conditional behavior
//
// Variable Substitution:
// - ${VAR}: Environment variable
// - ${VAR:default}: With default value
// - ${random.uuid}: Generate unique ID
//
// Next Steps:
// → L5-02: Production environment config
// → L12-05: Use config in process flow
// =============================================================================
