// =============================================================================
// L12345-02: Production Configuration (L5)
// =============================================================================

config prod
    description "Production fraud detection configuration"

    kafka:
        bootstrap_servers "${KAFKA_BOOTSTRAP_SERVERS}"
        schema_registry "${SCHEMA_REGISTRY_URL}"
        security_protocol "SASL_SSL"

        topics:
            transactions:
                name "prod.transactions.incoming"
                partitions 48
                replication 3

            approved:
                name "prod.transactions.approved"
                partitions 48
                replication 3

            declined:
                name "prod.transactions.declined"
                partitions 12
                replication 3

            alerts:
                name "prod.fraud.alerts"
                partitions 12
                replication 3
    end

    flink:
        parallelism 24
        checkpoint_interval 30 seconds
        state_backend "rocksdb"
        state_path "s3://company-flink-state/fraud-detection"

        // Low latency tuning
        buffer_timeout 10 milliseconds
        network_memory_fraction 0.2
    end

    services:
        card_profile_service:
            url "${CARD_PROFILE_SERVICE_URL}"
            timeout 50 milliseconds
            retry 1
            circuit_breaker:
                threshold 10
                timeout 5 seconds

        ml_model_service:
            url "${ML_MODEL_SERVICE_URL}"
            timeout 50 milliseconds
            retry 0

        velocity_state_store:
            type "rocksdb"
            path "s3://company-flink-state/velocity"
            incremental_checkpoints true
    end

    // Production thresholds
    thresholds:
        high_amount 5000
        velocity_count_1h 10
        velocity_amount_1h 5000
        impossible_travel_km 5000
    end

    logging:
        level "WARN"
        format "json"
    end

    metrics:
        enabled true
        latency_histogram true
        labels:
            service "fraud-detection"
    end

    // Real-time alerting
    alerting:
        enabled true
        on_high_fraud_rate:
            threshold 5%
            window 5 minutes
            notify "pagerduty"
    end
end
