// =============================================================================
// L12345-04: Production Configuration (L5)
// =============================================================================

config prod
    description "Production event aggregation configuration"

    kafka:
        bootstrap_servers "${KAFKA_BOOTSTRAP_SERVERS}"
        schema_registry "${SCHEMA_REGISTRY_URL}"
        security_protocol "SASL_SSL"

        topics:
            events:
                name "prod.events.raw"
                partitions 48
                replication 3

            metrics:
                name "prod.metrics.aggregated"
                partitions 24
                replication 3

            alerts:
                name "prod.alerts"
                partitions 6
                replication 3
    end

    flink:
        parallelism 24
        checkpoint_interval 1 minute
        state_backend "rocksdb"
        state_path "s3://company-flink-state/event-aggregator"

        // Handle high throughput
        buffer_timeout 100 milliseconds
    end

    // Production window settings
    windows:
        minute_window 1 minute
        hourly_window 1 hour

        // Allow late events
        allowed_lateness 5 minutes

        // Watermark strategy
        watermark_idle_timeout 1 minute
    end

    services:
        geo_service:
            url "${GEO_SERVICE_URL}"
            timeout 500 milliseconds
            cache_size 100000

        baseline_metrics:
            type "redis"
            url "${REDIS_URL}"
            ttl 1 hour

        revenue_baseline:
            type "redis"
            url "${REDIS_URL}"
            ttl 1 hour
    end

    // Production thresholds
    thresholds:
        error_rate_warning 10
        error_rate_critical 50
        traffic_spike_multiplier 3
        traffic_drop_multiplier 0.3
        min_events_for_alert 100
    end

    logging:
        level "INFO"
        format "json"
    end

    metrics:
        enabled true
        labels:
            service "event-aggregator"
            environment "production"
    end

    // Alert routing
    alerting:
        enabled true
        routes:
            critical:
                destination "pagerduty"
            warning:
                destination "slack"
                channel "#alerts"
            info:
                destination "datadog"
    end
end
