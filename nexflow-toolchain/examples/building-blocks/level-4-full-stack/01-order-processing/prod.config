// =============================================================================
// L12345-01: Production Configuration (L5)
// =============================================================================

config prod
    description "Production environment configuration"

    kafka:
        bootstrap_servers "${KAFKA_BOOTSTRAP_SERVERS}"
        schema_registry "${SCHEMA_REGISTRY_URL}"
        security_protocol "SASL_SSL"
        sasl_mechanism "PLAIN"

        topics:
            orders:
                name "prod.orders.incoming"
                partitions 24
                replication 3

            fulfillment:
                name "prod.orders.fulfillment"
                partitions 24
                replication 3

            errors:
                name "prod.orders.errors"
                partitions 6
                replication 3

            hold:
                name "prod.orders.hold"
                partitions 6
                replication 3
    end

    flink:
        parallelism 12
        checkpoint_interval 1 minute
        state_backend "rocksdb"
        state_path "s3://company-flink-state/order-processing"

        restart_strategy:
            type "fixed-delay"
            attempts 5
            delay 30 seconds
    end

    services:
        customer_service:
            url "${CUSTOMER_SERVICE_URL}"
            timeout 10 seconds
            retry 3
            circuit_breaker:
                threshold 5
                timeout 30 seconds

        inventory_service:
            url "${INVENTORY_SERVICE_URL}"
            timeout 5 seconds
            retry 3
            circuit_breaker:
                threshold 5
                timeout 30 seconds

        tax_service:
            url "${TAX_SERVICE_URL}"
            timeout 3 seconds
            retry 2

        promotion_service:
            url "${PROMOTION_SERVICE_URL}"
            timeout 3 seconds
            retry 2
    end

    logging:
        level "INFO"
        format "json"
    end

    metrics:
        enabled true
        provider "prometheus"
        port 9090
        labels:
            service "order-processing"
            environment "production"
    end

    alerting:
        enabled true
        on_error:
            notify "pagerduty"
            severity "high"
    end
end
