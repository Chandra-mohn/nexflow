/**
 * EnrichedTransaction
 *
 * Record for enriched_transaction schema
 *
 * AUTO-GENERATED by Nexflow Code Generator
 * DO NOT EDIT - Changes will be overwritten
 *
 * Generator: SchemaGenerator
 */

package nexflow.flink.schema;

import java.io.Serializable;
import java.math.BigDecimal;
import java.time.Instant;
import java.util.Objects;
import java.util.UUID;


public record EnrichedTransaction(
    // Required
    UUID transactionId,
    // Required
    String customerId,
    // Required
    BigDecimal amount,
    // Required
    BigDecimal normalizedAmount,
    // Required
    String merchantId,
    // Required
    String riskTier,
    // Required
    BigDecimal creditLimit,
    // Required
    Long accountAge,
    // Required
    Long velocity24h,
    // Required
    BigDecimal fraudProbability,
    // Required
    Instant eventTimestamp,
    // Required
    Instant processingTimestamp
) implements Serializable {

    private static final long serialVersionUID = 1L;

    // =========================================================================
    // Schema Version Metadata
    // =========================================================================

    public static final String SCHEMA_VERSION = "1.0.0";
    public static final String SCHEMA_NAME = "enriched_transaction";

    // =========================================================================
    // Streaming Configuration Constants
    // =========================================================================

    public static final String TIME_FIELD = "event_timestamp";
    public static final String[] KEY_FIELDS = {"transaction_id"};

    /**
     * Compact constructor - validates required fields.
     */
    public EnrichedTransaction {
        Objects.requireNonNull(transactionId, "transaction_id is required");
        Objects.requireNonNull(customerId, "customer_id is required");
        Objects.requireNonNull(amount, "amount is required");
        Objects.requireNonNull(normalizedAmount, "normalized_amount is required");
        Objects.requireNonNull(merchantId, "merchant_id is required");
        Objects.requireNonNull(riskTier, "risk_tier is required");
        Objects.requireNonNull(creditLimit, "credit_limit is required");
        Objects.requireNonNull(accountAge, "account_age is required");
        Objects.requireNonNull(velocity24h, "velocity_24h is required");
        Objects.requireNonNull(fraudProbability, "fraud_probability is required");
        Objects.requireNonNull(eventTimestamp, "event_timestamp is required");
        Objects.requireNonNull(processingTimestamp, "processing_timestamp is required");
    }

    /**
     * Create a copy with modified transactionId.
     * @param transactionId The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withTransactionId(UUID transactionId) {
        return new EnrichedTransaction(transactionId, customerId(), amount(), normalizedAmount(), merchantId(), riskTier(), creditLimit(), accountAge(), velocity24h(), fraudProbability(), eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified customerId.
     * @param customerId The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withCustomerId(String customerId) {
        return new EnrichedTransaction(transactionId(), customerId, amount(), normalizedAmount(), merchantId(), riskTier(), creditLimit(), accountAge(), velocity24h(), fraudProbability(), eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified amount.
     * @param amount The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withAmount(BigDecimal amount) {
        return new EnrichedTransaction(transactionId(), customerId(), amount, normalizedAmount(), merchantId(), riskTier(), creditLimit(), accountAge(), velocity24h(), fraudProbability(), eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified normalizedAmount.
     * @param normalizedAmount The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withNormalizedAmount(BigDecimal normalizedAmount) {
        return new EnrichedTransaction(transactionId(), customerId(), amount(), normalizedAmount, merchantId(), riskTier(), creditLimit(), accountAge(), velocity24h(), fraudProbability(), eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified merchantId.
     * @param merchantId The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withMerchantId(String merchantId) {
        return new EnrichedTransaction(transactionId(), customerId(), amount(), normalizedAmount(), merchantId, riskTier(), creditLimit(), accountAge(), velocity24h(), fraudProbability(), eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified riskTier.
     * @param riskTier The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withRiskTier(String riskTier) {
        return new EnrichedTransaction(transactionId(), customerId(), amount(), normalizedAmount(), merchantId(), riskTier, creditLimit(), accountAge(), velocity24h(), fraudProbability(), eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified creditLimit.
     * @param creditLimit The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withCreditLimit(BigDecimal creditLimit) {
        return new EnrichedTransaction(transactionId(), customerId(), amount(), normalizedAmount(), merchantId(), riskTier(), creditLimit, accountAge(), velocity24h(), fraudProbability(), eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified accountAge.
     * @param accountAge The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withAccountAge(Long accountAge) {
        return new EnrichedTransaction(transactionId(), customerId(), amount(), normalizedAmount(), merchantId(), riskTier(), creditLimit(), accountAge, velocity24h(), fraudProbability(), eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified velocity24h.
     * @param velocity24h The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withVelocity24h(Long velocity24h) {
        return new EnrichedTransaction(transactionId(), customerId(), amount(), normalizedAmount(), merchantId(), riskTier(), creditLimit(), accountAge(), velocity24h, fraudProbability(), eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified fraudProbability.
     * @param fraudProbability The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withFraudProbability(BigDecimal fraudProbability) {
        return new EnrichedTransaction(transactionId(), customerId(), amount(), normalizedAmount(), merchantId(), riskTier(), creditLimit(), accountAge(), velocity24h(), fraudProbability, eventTimestamp(), processingTimestamp());
    }

    /**
     * Create a copy with modified eventTimestamp.
     * @param eventTimestamp The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withEventTimestamp(Instant eventTimestamp) {
        return new EnrichedTransaction(transactionId(), customerId(), amount(), normalizedAmount(), merchantId(), riskTier(), creditLimit(), accountAge(), velocity24h(), fraudProbability(), eventTimestamp, processingTimestamp());
    }

    /**
     * Create a copy with modified processingTimestamp.
     * @param processingTimestamp The new value
     * @return New record instance with updated value
     */
    public EnrichedTransaction withProcessingTimestamp(Instant processingTimestamp) {
        return new EnrichedTransaction(transactionId(), customerId(), amount(), normalizedAmount(), merchantId(), riskTier(), creditLimit(), accountAge(), velocity24h(), fraudProbability(), eventTimestamp(), processingTimestamp);
    }

    /**
     * Generate correlation key from specified fields.
     * Used by Flink keying operations for event correlation.
     *
     * @param fields Array of field names to include in the key
     * @return Concatenated string key from field values
     */
    public String getCorrelationKey(String[] fields) {
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < fields.length; i++) {
            if (i > 0) sb.append(":");
            switch (fields[i]) {
                case "transaction_id":
                    sb.append(transactionId());
                    break;
                case "customer_id":
                    sb.append(customerId());
                    break;
                case "amount":
                    sb.append(amount());
                    break;
                case "normalized_amount":
                    sb.append(normalizedAmount());
                    break;
                case "merchant_id":
                    sb.append(merchantId());
                    break;
                case "risk_tier":
                    sb.append(riskTier());
                    break;
                case "credit_limit":
                    sb.append(creditLimit());
                    break;
                case "account_age":
                    sb.append(accountAge());
                    break;
                case "velocity_24h":
                    sb.append(velocity24h());
                    break;
                case "fraud_probability":
                    sb.append(fraudProbability());
                    break;
                case "event_timestamp":
                    sb.append(eventTimestamp());
                    break;
                case "processing_timestamp":
                    sb.append(processingTimestamp());
                    break;
                default:
                    sb.append("null");
            }
        }
        return sb.toString();
    }

    /**
     * Alias for getCorrelationKey - used by hold patterns for buffer keying.
     */
    public String getBufferKey(String[] fields) {
        return getCorrelationKey(fields);
    }

    /**
     * Get simple key for this record (first identity field or fallback).
     * Used by window operations and RoutedEvent compatibility.
     */
    public String getKey() {
        // Return first non-null identity field as default key
        Object val = transactionId();
        return val != null ? val.toString() : "null";
    }

    /**
     * Get the timestamp value for event time processing.
     * Configured time field: event_timestamp
     */
    public long getEventTimestamp() {
        Object ts = eventTimestamp();
        if (ts == null) return System.currentTimeMillis();
        if (ts instanceof Long) return (Long) ts;
        if (ts instanceof java.time.Instant) return ((java.time.Instant) ts).toEpochMilli();
        if (ts instanceof java.util.Date) return ((java.util.Date) ts).getTime();
        return System.currentTimeMillis();
    }


}
